<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ayarlar - Birlik Elektrik Admin</title>
    
    <!-- Fontawesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts - Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Admin CSS -->
    <link rel="stylesheet" href="assets/css/admin.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <!-- Firebase Config -->
    <script src="../js/firebase/config.js"></script>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="admin-sidebar" id="sidebar">
            <div class="admin-sidebar-header">
                <div class="admin-logo">
                    <img src="assets/img/logo.jpg" alt="Birlik Elektrik">
                    <span>Birlik Elektrik</span>
                </div>
                <button id="sidebarToggle" class="admin-sidebar-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="admin-sidebar-content">
                <ul class="admin-menu">
                    <li class="admin-menu-item">
                        <a href="index.html" class="admin-menu-link" id="dashboard-link">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                    </li>
                    
                    <li class="admin-menu-item">
                        <a href="projects.html" class="admin-menu-link" id="projects-link">
                            <i class="fas fa-project-diagram"></i> Projeler
                        </a>
                    </li>
                    
                    <li class="admin-menu-item">
                        <a href="services.html" class="admin-menu-link" id="services-link">
                            <i class="fas fa-tools"></i> Hizmetler
                        </a>
                    </li>
                    
                    <li class="admin-menu-item">
                        <a href="gallery.html" class="admin-menu-link" id="gallery-link">
                            <i class="fas fa-images"></i> Galeri
                        </a>
                    </li>
                    
                    <li class="admin-menu-item">
                        <a href="team.html" class="admin-menu-link" id="team-link">
                            <i class="fas fa-users"></i> Takım
                        </a>
                    </li>
                    
                    <li class="admin-menu-item">
                        <a href="pages.html" class="admin-menu-link" id="pages-link">
                            <i class="fas fa-file-alt"></i> Sayfalar
                        </a>
                    </li>
                    
                    <li class="admin-menu-item">
                        <a href="messages.html" class="admin-menu-link" id="messages-link">
                            <i class="fas fa-envelope"></i> Mesajlar
                            <span class="admin-menu-badge" id="unreadMessagesBadge">0</span>
                        </a>
                    </li>
                    
                    <li class="admin-menu-item">
                        <a href="users.html" class="admin-menu-link" id="users-link">
                            <i class="fas fa-user"></i> Kullanıcılar
                        </a>
                    </li>
                    
                    <li class="admin-menu-item">
                        <a href="settings.html" class="admin-menu-link active" id="settings-link">
                            <i class="fas fa-cog"></i> Ayarlar
                        </a>
                    </li>
                    
                    <li class="admin-menu-item">
                        <a href="data-migration.html" class="admin-menu-link" id="data-migration-link">
                            <i class="fas fa-database"></i> Veri Aktarımı
                        </a>
                    </li>
                </ul>
            </div>
            
            <div class="admin-user-profile">
                <div class="admin-user-avatar" id="userInitials">AK</div>
                <div class="admin-user-info">
                    <div class="admin-user-name" id="userName">Admin Kullanıcı</div>
                    <div class="admin-user-email" id="userEmail">admin@birlikelektrik.com</div>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="admin-main">
            <!-- Header -->
            <header class="admin-header">
                <button id="mobileMenuToggle" class="admin-btn-icon admin-mobile-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                
                <h1 class="admin-header-title">Ayarlar</h1>
                
                <div class="admin-header-actions">
                    <div class="dark-mode-toggle">
                        <button id="darkModeToggle" class="admin-btn-icon">
                            <i class="fas fa-moon"></i>
                        </button>
                    </div>
                    
                    <div class="admin-user-dropdown">
                        <button id="logoutButton" class="admin-btn admin-btn-outline-primary">
                            <i class="fas fa-sign-out-alt"></i> Çıkış
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- Content -->
            <div class="admin-content">
                <!-- Bildirimler için konteyner -->
                <div class="admin-alerts"></div>
                
                <!-- Ayarlar içeriği -->
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h2 class="admin-card-title">
                            <i class="fas fa-building"></i> Firma Bilgileri
                        </h2>
                    </div>
                    <div class="admin-card-body">
                        <div class="admin-form-group">
                            <label class="admin-form-label">Firma Adı</label>
                            <input type="text" id="companyName" class="admin-form-input" placeholder="Firmanızın adını girin">
                        </div>
                        
                        <div class="admin-form-group">
                            <label class="admin-form-label">Slogan</label>
                            <input type="text" id="companySlogan" class="admin-form-input" placeholder="Firmanızın sloganını girin">
                        </div>
                        
                        <div class="admin-form-group">
                            <label class="admin-form-label">Logo</label>
                            <div class="admin-logo-preview-container">
                                <img id="logoPreview" src="" alt="Logo Önizleme" style="max-width: 200px; max-height: 100px; display: none;">
                            </div>
                            <input type="file" id="logoFile" class="admin-form-input" accept="image/*">
                            <div class="admin-form-help">Önerilen boyut: 200x80 piksel, PNG veya SVG formatı</div>
                        </div>
                        
                        <div class="admin-form-group">
                            <label class="admin-form-label">Favicon</label>
                            <div class="admin-favicon-preview-container">
                                <img id="faviconPreview" src="" alt="Favicon Önizleme" style="max-width: 32px; max-height: 32px; display: none;">
                            </div>
                            <input type="file" id="faviconFile" class="admin-form-input" accept="image/*">
                            <div class="admin-form-help">Önerilen boyut: 32x32 piksel, PNG veya ICO formatı</div>
                        </div>
                        
                        <div class="admin-form-group">
                            <label class="admin-form-label">Hakkımızda (Kısa)</label>
                            <textarea id="companyShortDescription" class="admin-form-textarea" rows="3" placeholder="Ana sayfada görünecek kısa açıklama"></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h2 class="admin-card-title">
                            <i class="fas fa-address-book"></i> İletişim Bilgileri
                        </h2>
                    </div>
                    <div class="admin-card-body">
                        <div class="admin-form-group">
                            <label class="admin-form-label">Adres</label>
                            <textarea id="companyAddress" class="admin-form-textarea" rows="3" placeholder="Şirketin açık adresini girin"></textarea>
                        </div>
                        
                        <div class="admin-form-row">
                            <div class="admin-form-col">
                                <div class="admin-form-group">
                                    <label class="admin-form-label">E-posta</label>
                                    <input type="email" id="companyEmail" class="admin-form-input" placeholder="info@example.com">
                                </div>
                            </div>
                            
                            <div class="admin-form-col">
                                <div class="admin-form-group">
                                    <label class="admin-form-label">Telefon</label>
                                    <input type="tel" id="companyPhone" class="admin-form-input" placeholder="+90 xxx xxx xx xx">
                                </div>
                            </div>
                        </div>
                        
                        <div class="admin-form-row">
                            <div class="admin-form-col">
                                <div class="admin-form-group">
                                    <label class="admin-form-label">WhatsApp</label>
                                    <input type="tel" id="companyWhatsapp" class="admin-form-input" placeholder="+90 xxx xxx xx xx">
                                </div>
                            </div>
                            
                            <div class="admin-form-col">
                                <div class="admin-form-group">
                                    <label class="admin-form-label">Fax</label>
                                    <input type="tel" id="companyFax" class="admin-form-input" placeholder="+90 xxx xxx xx xx">
                                </div>
                            </div>
                        </div>
                        
                        <div class="admin-form-group">
                            <label class="admin-form-label">Google Harita Bilgisi</label>
                            <textarea id="companyMapIframe" class="admin-form-textarea" rows="3" placeholder="Google Haritalar iframe kodunu buraya yapıştırın"></textarea>
                            <div class="admin-form-help">Google Haritalar'dan "Paylaş > Haritayı yerleştir" seçeneğinden embed kodunu kopyalayın.</div>
                        </div>
                    </div>
                </div>
                
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h2 class="admin-card-title">
                            <i class="fas fa-share-alt"></i> Sosyal Medya
                        </h2>
                    </div>
                    <div class="admin-card-body">
                        <div class="admin-form-row">
                            <div class="admin-form-col">
                                <div class="admin-form-group">
                                    <label class="admin-form-label">Facebook</label>
                                    <div class="admin-input-icon">
                                        <i class="fab fa-facebook"></i>
                                        <input type="url" id="socialFacebook" class="admin-form-input" placeholder="https://facebook.com/...">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="admin-form-col">
                                <div class="admin-form-group">
                                    <label class="admin-form-label">Instagram</label>
                                    <div class="admin-input-icon">
                                        <i class="fab fa-instagram"></i>
                                        <input type="url" id="socialInstagram" class="admin-form-input" placeholder="https://instagram.com/...">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="admin-form-row">
                            <div class="admin-form-col">
                                <div class="admin-form-group">
                                    <label class="admin-form-label">Twitter</label>
                                    <div class="admin-input-icon">
                                        <i class="fab fa-twitter"></i>
                                        <input type="url" id="socialTwitter" class="admin-form-input" placeholder="https://twitter.com/...">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="admin-form-col">
                                <div class="admin-form-group">
                                    <label class="admin-form-label">LinkedIn</label>
                                    <div class="admin-input-icon">
                                        <i class="fab fa-linkedin"></i>
                                        <input type="url" id="socialLinkedin" class="admin-form-input" placeholder="https://linkedin.com/company/...">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="admin-form-row">
                            <div class="admin-form-col">
                                <div class="admin-form-group">
                                    <label class="admin-form-label">YouTube</label>
                                    <div class="admin-input-icon">
                                        <i class="fab fa-youtube"></i>
                                        <input type="url" id="socialYoutube" class="admin-form-input" placeholder="https://youtube.com/...">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="admin-form-col">
                                <div class="admin-form-group">
                                    <label class="admin-form-label">Pinterest</label>
                                    <div class="admin-input-icon">
                                        <i class="fab fa-pinterest"></i>
                                        <input type="url" id="socialPinterest" class="admin-form-input" placeholder="https://pinterest.com/...">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h2 class="admin-card-title">
                            <i class="fas fa-globe"></i> SEO Ayarları
                        </h2>
                    </div>
                    <div class="admin-card-body">
                        <div class="admin-form-group">
                            <label class="admin-form-label">Site Başlığı (Title)</label>
                            <input type="text" id="seoTitle" class="admin-form-input" placeholder="Ana sayfa için SEO başlığı">
                            <div class="admin-form-help">İdeal uzunluk: 50-60 karakter</div>
                        </div>
                        
                        <div class="admin-form-group">
                            <label class="admin-form-label">Site Açıklaması (Description)</label>
                            <textarea id="seoDescription" class="admin-form-textarea" rows="3" placeholder="Ana sayfa için SEO açıklaması"></textarea>
                            <div class="admin-form-help">İdeal uzunluk: 150-160 karakter</div>
                        </div>
                        
                        <div class="admin-form-group">
                            <label class="admin-form-label">Anahtar Kelimeler (Keywords)</label>
                            <input type="text" id="seoKeywords" class="admin-form-input" placeholder="anahtar,kelimeler,virgülle,ayırın">
                        </div>
                        
                        <div class="admin-form-group">
                            <label class="admin-form-label">Google Analytics Kodu</label>
                            <textarea id="googleAnalyticsCode" class="admin-form-textarea" rows="3" placeholder="Google Analytics izleme kodunu buraya yapıştırın"></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="admin-form-actions">
                    <button id="saveSettings" class="admin-btn admin-btn-primary">
                        <i class="fas fa-save"></i> Ayarları Kaydet
                    </button>
                    <button id="resetSettings" class="admin-btn admin-btn-light">
                        <i class="fas fa-undo"></i> Varsayılana Sıfırla
                    </button>
                </div>
            </div>
            
            <!-- Footer -->
            <footer class="admin-footer">
                &copy; <span id="currentYear">2023</span> Birlik Elektrik Admin Panel. Tüm hakları saklıdır.
            </footer>
        </main>
    </div>
    
    <!-- Admin JS -->
    <script src="assets/js/admin.js"></script>
    
    <!-- Ayarlar Özgü Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Yıl bilgisini güncelle
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            // Ayarları yükle
            loadSettings();
            
            // Logo önizleme
            document.getElementById('logoFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById('logoPreview');
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Favicon önizleme
            document.getElementById('faviconFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById('faviconPreview');
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Ayarları kaydet
            document.getElementById('saveSettings').addEventListener('click', function() {
                saveSettings();
            });
            
            // Ayarları sıfırla
            document.getElementById('resetSettings').addEventListener('click', function() {
                if (confirm('Tüm ayarları varsayılan değerlere sıfırlamak istediğinizden emin misiniz?')) {
                    resetSettings();
                }
            });
            
            // Çıkış düğmesi
            document.getElementById('logoutButton').addEventListener('click', function() {
                firebase.auth().signOut().then(function() {
                    window.location.href = 'login.html';
                }).catch(function(error) {
                    showAlert('Çıkış yapılırken bir hata oluştu.', 'error');
                    console.error(error);
                });
            });
        });
        
        // Ayarları Yükleme Fonksiyonu
        function loadSettings() {
            const db = firebase.firestore();
            
            db.collection('settings').doc('general').get()
                .then(doc => {
                    if (doc.exists) {
                        const settings = doc.data();
                        
                        // Firma Bilgileri
                        document.getElementById('companyName').value = settings.companyName || '';
                        document.getElementById('companySlogan').value = settings.companySlogan || '';
                        document.getElementById('companyShortDescription').value = settings.companyShortDescription || '';
                        
                        // Logo
                        if (settings.logoUrl) {
                            document.getElementById('logoPreview').src = settings.logoUrl;
                            document.getElementById('logoPreview').style.display = 'block';
                        }
                        
                        // Favicon
                        if (settings.faviconUrl) {
                            document.getElementById('faviconPreview').src = settings.faviconUrl;
                            document.getElementById('faviconPreview').style.display = 'block';
                        }
                        
                        // İletişim Bilgileri
                        document.getElementById('companyAddress').value = settings.companyAddress || '';
                        document.getElementById('companyEmail').value = settings.companyEmail || '';
                        document.getElementById('companyPhone').value = settings.companyPhone || '';
                        document.getElementById('companyWhatsapp').value = settings.companyWhatsapp || '';
                        document.getElementById('companyFax').value = settings.companyFax || '';
                        document.getElementById('companyMapIframe').value = settings.companyMapIframe || '';
                        
                        // Sosyal Medya
                        document.getElementById('socialFacebook').value = settings.socialFacebook || '';
                        document.getElementById('socialInstagram').value = settings.socialInstagram || '';
                        document.getElementById('socialTwitter').value = settings.socialTwitter || '';
                        document.getElementById('socialLinkedin').value = settings.socialLinkedin || '';
                        document.getElementById('socialYoutube').value = settings.socialYoutube || '';
                        document.getElementById('socialPinterest').value = settings.socialPinterest || '';
                        
                        // SEO Ayarları
                        document.getElementById('seoTitle').value = settings.seoTitle || '';
                        document.getElementById('seoDescription').value = settings.seoDescription || '';
                        document.getElementById('seoKeywords').value = settings.seoKeywords || '';
                        document.getElementById('googleAnalyticsCode').value = settings.googleAnalyticsCode || '';
                    } else {
                        console.log('Ayarlar bulunamadı, varsayılan değerler kullanılıyor.');
                    }
                })
                .catch(error => {
                    console.error('Ayarlar yüklenirken hata:', error);
                    showAlert('Ayarlar yüklenirken bir hata oluştu.', 'error');
                });
        }
        
        // Ayarları Kaydetme Fonksiyonu
        async function saveSettings() {
            const db = firebase.firestore();
            const storage = firebase.storage();
            
            try {
                // Logo ve Favicon yükleme
                let logoUrl = document.getElementById('logoPreview').src;
                let faviconUrl = document.getElementById('faviconPreview').src;
                
                // Yeni logo yüklendiyse
                const logoFile = document.getElementById('logoFile').files[0];
                if (logoFile) {
                    const logoRef = storage.ref().child(`settings/logo_${Date.now()}`);
                    await logoRef.put(logoFile);
                    logoUrl = await logoRef.getDownloadURL();
                }
                
                // Yeni favicon yüklendiyse
                const faviconFile = document.getElementById('faviconFile').files[0];
                if (faviconFile) {
                    const faviconRef = storage.ref().child(`settings/favicon_${Date.now()}`);
                    await faviconRef.put(faviconFile);
                    faviconUrl = await faviconRef.getDownloadURL();
                }
                
                // Ayarları oluştur
                const settings = {
                    // Firma Bilgileri
                    companyName: document.getElementById('companyName').value,
                    companySlogan: document.getElementById('companySlogan').value,
                    companyShortDescription: document.getElementById('companyShortDescription').value,
                    logoUrl: logoUrl,
                    faviconUrl: faviconUrl,
                    
                    // İletişim Bilgileri
                    companyAddress: document.getElementById('companyAddress').value,
                    companyEmail: document.getElementById('companyEmail').value,
                    companyPhone: document.getElementById('companyPhone').value,
                    companyWhatsapp: document.getElementById('companyWhatsapp').value,
                    companyFax: document.getElementById('companyFax').value,
                    companyMapIframe: document.getElementById('companyMapIframe').value,
                    
                    // Sosyal Medya
                    socialFacebook: document.getElementById('socialFacebook').value,
                    socialInstagram: document.getElementById('socialInstagram').value,
                    socialTwitter: document.getElementById('socialTwitter').value,
                    socialLinkedin: document.getElementById('socialLinkedin').value,
                    socialYoutube: document.getElementById('socialYoutube').value,
                    socialPinterest: document.getElementById('socialPinterest').value,
                    
                    // SEO Ayarları
                    seoTitle: document.getElementById('seoTitle').value,
                    seoDescription: document.getElementById('seoDescription').value,
                    seoKeywords: document.getElementById('seoKeywords').value,
                    googleAnalyticsCode: document.getElementById('googleAnalyticsCode').value,
                    
                    // Son güncelleme
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Firestore'a kaydet
                await db.collection('settings').doc('general').set(settings, { merge: true });
                
                showAlert('Ayarlar başarıyla kaydedildi.', 'success');
            } catch (error) {
                console.error('Ayarlar kaydedilirken hata:', error);
                showAlert('Ayarlar kaydedilirken bir hata oluştu.', 'error');
            }
        }
        
        // Ayarları Sıfırlama Fonksiyonu
        function resetSettings() {
            // Forma varsayılan değerleri atama
            document.getElementById('companyName').value = 'Birlik Elektrik';
            document.getElementById('companySlogan').value = 'Profesyonel Elektrik Çözümleri';
            document.getElementById('companyShortDescription').value = 'Birlik Elektrik olarak, sektörde 20 yılı aşkın deneyimimizle profesyonel elektrik hizmetleri sunuyoruz.';
            
            document.getElementById('logoPreview').style.display = 'none';
            document.getElementById('faviconPreview').style.display = 'none';
            
            document.getElementById('companyAddress').value = 'Örnek Mahallesi, Örnek Caddesi No:123, İstanbul, Türkiye';
            document.getElementById('companyEmail').value = 'info@birlikelektrik.com';
            document.getElementById('companyPhone').value = '+90 212 123 45 67';
            document.getElementById('companyWhatsapp').value = '+90 555 123 45 67';
            document.getElementById('companyFax').value = '+90 212 123 45 68';
            document.getElementById('companyMapIframe').value = '';
            
            document.getElementById('socialFacebook').value = 'https://facebook.com/birlikelektrik';
            document.getElementById('socialInstagram').value = 'https://instagram.com/birlikelektrik';
            document.getElementById('socialTwitter').value = 'https://twitter.com/birlikelektrik';
            document.getElementById('socialLinkedin').value = 'https://linkedin.com/company/birlik-elektrik';
            document.getElementById('socialYoutube').value = '';
            document.getElementById('socialPinterest').value = '';
            
            document.getElementById('seoTitle').value = 'Birlik Elektrik - Profesyonel Elektrik Çözümleri';
            document.getElementById('seoDescription').value = '20 yılı aşkın deneyime sahip Birlik Elektrik, tüm elektrik ihtiyaçlarınız için hizmetinizdedir. Kaliteli, güvenli ve uygun fiyatlı çözümler.';
            document.getElementById('seoKeywords').value = 'elektrik, elektrik tesisatı, aydınlatma, pano, enerji, tasarruf, projeler';
            document.getElementById('googleAnalyticsCode').value = '';
            
            showAlert('Ayarlar varsayılan değerlere sıfırlandı, kaydetmek için "Ayarları Kaydet" butonuna tıklayın.', 'info');
        }
        
        // Uyarı Gösterme Fonksiyonu
        function showAlert(message, type = 'info') {
            const alertsContainer = document.querySelector('.admin-alerts');
            
            const alertHTML = `
            <div class="admin-alert admin-alert-${type}">
                <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                type === 'error' ? 'exclamation-circle' : 
                                type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <div>${message}</div>
            </div>
            `;
            
            const alertElement = document.createElement('div');
            alertElement.innerHTML = alertHTML;
            
            alertsContainer.appendChild(alertElement.firstElementChild);
            
            // Belirli bir süre sonra uyarıyı kaldırma
            setTimeout(() => {
                const insertedAlert = alertsContainer.lastElementChild;
                insertedAlert.style.opacity = '0';
                setTimeout(() => {
                    alertsContainer.removeChild(insertedAlert);
                }, 300);
            }, 5000);
        }
    </script>
</body>
</html> 