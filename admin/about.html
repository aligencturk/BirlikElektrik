<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birlik Elektrik Admin - Hakkımızda</title>
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="admin-header">
        <div class="container">
            <div class="admin-header-content">
                <div class="admin-menu">
                    <button id="sidebarToggle"><i class="fas fa-bars"></i></button>
                </div>
                <div class="admin-logo">
                    <img src="../img/elektrik-bg1.jpg" alt="Birlik Elektrik Logo">
                    <h1><span>Birlik</span> Elektrik</h1>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="admin-sidebar" id="adminSidebar">
        <div class="admin-sidebar-content">
            <div class="admin-sidebar-user">
                <div class="admin-user-avatar" id="userInitials">
                    A
                </div>
                <div class="admin-user-info">
                    <h3 id="userName">Admin</h3>
                    <p id="userEmail">admin@birlikelektrik.com</p>
                </div>
            </div>
            <ul class="admin-nav">
                <li class="admin-nav-item">
                    <a href="index.html" class="admin-nav-link">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                </li>
                <li class="admin-nav-item">
                    <a href="projects.html" class="admin-nav-link">
                        <i class="fas fa-project-diagram"></i> Projeler
                    </a>
                </li>
                <li class="admin-nav-item">
                    <a href="services.html" class="admin-nav-link">
                        <i class="fas fa-tools"></i> Hizmetler
                    </a>
                </li>
                <li class="admin-nav-item">
                    <a href="about.html" class="admin-nav-link active">
                        <i class="fas fa-info-circle"></i> Hakkımızda
                    </a>
                </li>
                <li class="admin-nav-item">
                    <a href="messages.html" class="admin-nav-link">
                        <i class="fas fa-envelope"></i> Mesajlar
                    </a>
                </li>
                <li class="admin-nav-item">
                    <a href="newsletter.html" class="admin-nav-link">
                        <i class="fas fa-newspaper"></i> Bülten Aboneleri
                    </a>
                </li>
                <li class="admin-nav-item">
                    <a href="#" id="logoutButton" class="admin-nav-link">
                        <i class="fas fa-sign-out-alt"></i> Çıkış Yap
                    </a>
                </li>
            </ul>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-content">
        <div class="container">
            <!-- Başlık ve Bağlantı Hatası Uyarısı -->
            <div class="content-header">
                <div>
                    <h1>Hakkımızda Sayfası Yönetimi</h1>
                    <p>Hakkımızda bölümünün içeriğini buradan düzenleyebilirsiniz.</p>
                </div>
                <div id="connectionAlert" class="alert alert-warning" style="display: none;">
                    <div>
                        <i class="fas fa-exclamation-triangle"></i>
                        <span id="connectionStatus">Bağlantı hatası. Veriler kaydedilmeyebilir.</span>
                    </div>
                    <button id="connectionRetryBtn" class="btn btn-sm">Yeniden Dene</button>
                </div>
            </div>

            <!-- Hakkımızda Formu -->
            <div class="admin-card">
                <div class="admin-card-header">
                    <h2>Hakkımızda Bilgileri</h2>
                    <div class="card-actions">
                        <button id="saveAboutBtn" class="btn btn-primary">
                            <i class="fas fa-save"></i> Kaydet
                        </button>
                    </div>
                </div>
                <div class="admin-card-body">
                    <form id="aboutForm">
                        <!-- Başlık ve Alt Başlık -->
                        <div class="admin-form-row">
                            <div class="admin-form-group">
                                <label for="aboutTitle">Ana Başlık</label>
                                <input type="text" id="aboutTitle" class="admin-form-control" placeholder="Örnek: Hakkımızda" required>
                            </div>
                            <div class="admin-form-group">
                                <label for="aboutSubtitle">Alt Başlık</label>
                                <input type="text" id="aboutSubtitle" class="admin-form-control" placeholder="Örnek: Birlik Elektrik olarak 20 yıllık tecrübemizle hizmetinizdeyiz" required>
                            </div>
                        </div>

                        <!-- Ana Metinler -->
                        <div class="admin-form-group">
                            <label for="aboutContent1">Birinci Paragraf</label>
                            <textarea id="aboutContent1" class="admin-form-control" rows="4" placeholder="Şirketiniz hakkında birinci paragraf bilgisi"></textarea>
                        </div>
                        <div class="admin-form-group">
                            <label for="aboutContent2">İkinci Paragraf</label>
                            <textarea id="aboutContent2" class="admin-form-control" rows="4" placeholder="Şirketiniz hakkında ikinci paragraf bilgisi"></textarea>
                        </div>

                        <!-- Özellik Listesi -->
                        <div class="admin-form-group">
                            <label>Özellikler (Virgülle ayrılmış olarak giriniz)</label>
                            <input type="text" id="aboutFeatures" class="admin-form-control" placeholder="Örnek: Uzman Kadro, Kaliteli Malzeme, Uygun Fiyat, Garantili İşçilik, 7/24 Hizmet">
                            <small class="text-muted">Özellikler virgül ile ayrılmalıdır. Örn: "Özellik 1, Özellik 2, Özellik 3"</small>
                        </div>

                        <!-- Sayısal İstatistikler -->
                        <div class="admin-card mt-20">
                            <div class="admin-card-header">
                                <h3>İstatistikler</h3>
                            </div>
                            <div class="admin-card-body">
                                <div class="admin-form-row">
                                    <div class="admin-form-group">
                                        <label for="aboutExperience">Tecrübe (Yıl)</label>
                                        <input type="number" id="aboutExperience" class="admin-form-control" placeholder="Örnek: 20">
                                    </div>
                                    <div class="admin-form-group">
                                        <label for="aboutProjects">Tamamlanan Proje Sayısı</label>
                                        <input type="number" id="aboutProjects" class="admin-form-control" placeholder="Örnek: 1500">
                                    </div>
                                </div>
                                <div class="admin-form-row">
                                    <div class="admin-form-group">
                                        <label for="aboutExperts">Uzman Personel Sayısı</label>
                                        <input type="number" id="aboutExperts" class="admin-form-control" placeholder="Örnek: 50">
                                    </div>
                                    <div class="admin-form-group">
                                        <label for="aboutSatisfaction">Müşteri Memnuniyeti (%)</label>
                                        <input type="number" id="aboutSatisfaction" class="admin-form-control" min="0" max="100" placeholder="Örnek: 99">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hakkımızda Sayfası Görseli -->
                        <div class="admin-form-group mt-20">
                            <label for="aboutImage">Hakkımızda Görseli</label>
                            <div class="image-upload-container">
                                <input type="file" id="aboutImage" class="admin-form-control" accept="image/*">
                                <div class="image-upload-info">
                                    <p><i class="fas fa-info-circle"></i> Önerilen boyut: 800x600px, <strong>Maksimum boyut: 2MB</strong></p>
                                    <p><i class="fas fa-check-circle"></i> Desteklenen formatlar: JPG, PNG, GIF</p>
                                    <p><i class="fas fa-exclamation-triangle text-warning"></i> Not: Görsel Base64 formatında saklanacaktır.</p>
                                </div>
                            </div>
                            <div id="imagePreviewContainer" style="margin-top: 15px; display: none;">
                                <p>Seçilen Görsel:</p>
                                <img id="imagePreview" src="" alt="Hakkımızda Görseli" style="max-width: 100%; max-height: 200px; display: block; margin-bottom: 10px;">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Firebase JS -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    
    <!-- Firebase Config -->
    <script src="../js/firebase/config.js"></script>
    
    <!-- Admin JS -->
    <script>
        // Kullanıcı girişini kontrol et
        firebase.auth().onAuthStateChanged(function(user) {
            if (!user) {
                // Kullanıcı giriş yapmamışsa login sayfasına yönlendir
                console.log('Kullanıcı giriş yapmamış, login sayfasına yönlendiriliyor...');
                window.location.href = 'login.html';
                return;
            }

            console.log('Kullanıcı giriş yapmış:', user.email);
            initializeAdmin(user);
        });

        // Admin arayüzünü başlat
        function initializeAdmin(user) {
            // Sidebar Toggle
            const sidebarToggle = document.getElementById('sidebarToggle');
            const adminSidebar = document.getElementById('adminSidebar');
            
            sidebarToggle.addEventListener('click', function() {
                adminSidebar.classList.toggle('show');
                
                // Icon değiştir
                const icon = this.querySelector('i');
                if (icon.classList.contains('fa-bars')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });
            
            // Çıkış yapma
            const logoutButton = document.getElementById('logoutButton');
            
            logoutButton.addEventListener('click', async function(e) {
                e.preventDefault();
                
                try {
                    await firebase.auth().signOut();
                    window.location.href = 'login.html';
                } catch (error) {
                    console.error('Çıkış yapılırken hata oluştu:', error);
                    alert('Çıkış yapılırken bir hata oluştu.');
                }
            });
            
            // Kullanıcı bilgilerini göster
            const userEmail = document.getElementById('userEmail');
            const userName = document.getElementById('userName');
            const userInitials = document.getElementById('userInitials');
            
            userEmail.textContent = user.email;
            
            if (user.displayName) {
                userName.textContent = user.displayName;
                
                // Baş harfleri göster
                const nameParts = user.displayName.split(' ');
                const initials = nameParts.length > 1 
                    ? nameParts[0].charAt(0) + nameParts[1].charAt(0) 
                    : nameParts[0].charAt(0);
                
                userInitials.textContent = initials.toUpperCase();
            } else {
                // E-posta adresinden başlangıç harflerini alıp göster
                const emailParts = user.email.split('@');
                const name = emailParts[0];
                
                userName.textContent = name.charAt(0).toUpperCase() + name.slice(1);
                userInitials.textContent = name.charAt(0).toUpperCase();
            }
            
            // Hakkımızda verilerini yükle
            loadAboutData();
        }

        // Mevcut About Us verilerini getir
        async function loadAboutData() {
            try {
                showSpinner(true);
                const aboutData = await dbHelper.getAboutData();
                
                // Formun inputlarını doldur
                document.getElementById('aboutTitle').value = aboutData.title || '';
                document.getElementById('aboutSubtitle').value = aboutData.subtitle || '';
                document.getElementById('aboutContent1').value = aboutData.content1 || '';
                document.getElementById('aboutContent2').value = aboutData.content2 || '';
                
                // Özellikleri doldur
                if (aboutData.features && aboutData.features.length > 0) {
                    document.getElementById('aboutFeature1').value = aboutData.features[0] || '';
                    document.getElementById('aboutFeature2').value = aboutData.features[1] || '';
                    document.getElementById('aboutFeature3').value = aboutData.features[2] || '';
                    document.getElementById('aboutFeature4').value = aboutData.features[3] || '';
                }
                
                // İstatistikleri doldur
                document.getElementById('aboutExperience').value = aboutData.experience || '';
                document.getElementById('aboutProjects').value = aboutData.completedProjects || '';
                document.getElementById('aboutExperts').value = aboutData.expertStaff || '';
                document.getElementById('aboutSatisfaction').value = aboutData.customerSatisfaction || '';
                
                // Görsel varsa göster
                if (aboutData.imageUrl) {
                    const previewContainer = document.getElementById('imagePreview');
                    previewContainer.style.display = 'block';
                    previewContainer.innerHTML = `<img src="${aboutData.imageUrl}" alt="Hakkımızda Görseli">`;
                }
                
                showSpinner(false);
            } catch (error) {
                console.error('Hakkımızda verileri getirilirken hata oluştu:', error);
                showAlert('danger', 'Veriler yüklenirken bir hata oluştu. Lütfen sayfayı yenileyip tekrar deneyin.');
                showSpinner(false);
            }
        }
        
        // Form submit işlemi
        document.getElementById('aboutForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            try {
                showSpinner(true);
                
                // Form verilerini al
                const aboutData = {
                    title: document.getElementById('aboutTitle').value,
                    subtitle: document.getElementById('aboutSubtitle').value,
                    content1: document.getElementById('aboutContent1').value,
                    content2: document.getElementById('aboutContent2').value,
                    features: [
                        document.getElementById('aboutFeature1').value,
                        document.getElementById('aboutFeature2').value,
                        document.getElementById('aboutFeature3').value,
                        document.getElementById('aboutFeature4').value
                    ],
                    experience: document.getElementById('aboutExperience').value,
                    completedProjects: document.getElementById('aboutProjects').value,
                    expertStaff: document.getElementById('aboutExperts').value,
                    customerSatisfaction: document.getElementById('aboutSatisfaction').value
                };
                
                // Görsel varsa ekle
                const imageFile = document.getElementById('aboutImage').files[0];
                
                // Firebase'e kaydet
                const result = await dbHelper.saveAboutData(aboutData, imageFile);
                
                if (result.success) {
                    showAlert('success', 'Hakkımızda bilgileri başarıyla güncellendi.');
                    
                    // Görsel yüklenmişse önizlemeyi güncelle
                    if (imageFile && result.imageUrl) {
                        const previewContainer = document.getElementById('imagePreview');
                        previewContainer.style.display = 'block';
                        previewContainer.innerHTML = `<img src="${result.imageUrl}" alt="Hakkımızda Görseli">`;
                    }
                } else {
                    showAlert('danger', `Hata: ${result.error}`);
                }
                
                showSpinner(false);
            } catch (error) {
                console.error('Hakkımızda bilgileri güncellenirken hata oluştu:', error);
                showAlert('danger', 'Veriler kaydedilirken bir hata oluştu. Lütfen tekrar deneyin.');
                showSpinner(false);
            }
        });
        
        // Görsel önizleme
        document.getElementById('aboutImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const previewContainer = document.getElementById('imagePreview');
                previewContainer.style.display = 'block';
                previewContainer.innerHTML = `<img src="${event.target.result}" alt="Hakkımızda Görseli">`;
            };
            reader.readAsDataURL(file);
        });
        
        // Spinner göster/gizle
        function showSpinner(show) {
            const spinner = document.getElementById('formSpinner');
            const submitBtn = document.getElementById('submitBtn');
            
            if (show) {
                spinner.style.display = 'inline-block';
                submitBtn.disabled = true;
            } else {
                spinner.style.display = 'none';
                submitBtn.disabled = false;
            }
        }
        
        // Alert göster
        function showAlert(type, message) {
            const alertContainer = document.getElementById('alertContainer');
            alertContainer.innerHTML = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="close" data-dismiss="alert">
                        <span>&times;</span>
                    </button>
                </div>
            `;
            
            // 5 saniye sonra otomatik kapat
            setTimeout(() => {
                const alert = alertContainer.querySelector('.alert');
                if (alert) {
                    alert.remove();
                }
            }, 5000);
        }
        
        // Alert kapatma
        document.addEventListener('click', function(e) {
            if (e.target.closest('[data-dismiss="alert"]')) {
                e.preventDefault();
                e.target.closest('.alert').remove();
            }
        });
    </script>
</body>
</html> 